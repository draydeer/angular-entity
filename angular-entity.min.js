(function(t,e){"use strict";var i=e.$$minErr("$resty");e.module("ngResty",["ng"]).factory("$resty",["$http","$q",function(t,i){var s=e.noop,r=e.forEach,n=e.extend,o=e.copy;function h(t,e){this.compileStrictly=e!==false;var i,s=/[^\\]:([\w\$]+)/g,r=[];while(i=s.exec(t)){r.push(i[1])}this.routeParams=r;this.route=t;t=t.replace(/([^\\]):([\w\$]+)/g,"$1!@$#$2#$@!");var n=t.indexOf("?");if(n!==-1){this.path=t.substr(0,n);this.q=t.substr(n+1)}else{this.path=t;this.q=null}}h.prototype={compileQuery:function(t){var e=this.compileStrictly,i=this.path,s=this.route,n=this.q;if(t){if(i){r(this.routeParams,function(r){if(r in t){i=i.replace("!@$#"+r+"#$@!",t[r])}else{if(e){throw new Error("Path parameter missing: "+r+" on "+s)}}})}if(n){r(this.routeParams,function(i){if(i in t){n=n.replace("!@$#"+i+"#$@!",encodeURIComponent(t[i]))}else{if(e){throw new Error("Path parameter missing: "+i+" on "+s)}}})}}return n?i+"?"+n:i},"delete":function(e,i,s){return t.delete(this.compileQuery(e),n(s||{},{data:i}))},get:function(e,i,s){return t.get(this.compileQuery(e),n(s||{},{data:i}))},head:function(e,i,s){return t.head(this.compileQuery(e),n(s||{},{data:i}))},options:function(e,i,s){return t.options(this.compileQuery(e),i,s)},patch:function(e,i,s){return t.patch(this.compileQuery(e),i,s)},post:function(e,i,s){return t.post(this.compileQuery(e),i,s)},put:function(e,i,s){return t.put(this.compileQuery(e),i,s)},trace:function(e,i,s){return t.trace(this.compileQuery(e),i,s)}};function p(t,e){this.base=t;this.deferred=[];this.errorHandler=null;this.queued=false;this.rawResponse=true;this.responseSimpleOnce=false;this.routes=e;this.successHandler=null;this.addRoutes(e)}p.prototype={setErrorHandler:function(t){this.errorHandler=e.isFunction(t)?t:null;return this},setQueued:function(t){this.queued=t===true;return this},setRawResponse:function(t){this.rawResponse=t===true;return this},setResponseSimpleOnce:function(t){this.responseSimpleOnce=t===true;return this},setSuccessHandler:function(t){this.successHandler=e.isFunction(t)?t:null;return this},addRoutes:function(t){if(e.isObject(t)){r(t,function(s,r){var n,o,p,u;if(typeof s==="string"){o="get";p=this.base+"/"+s}else{if(e.isArray(s)){if(s.length===0){throw new Error("Route is not defined: "+r)}o=s[1]||"get";p=this.base+"/"+s[0]}else{o=s.method||"get";if(s.route===void 0){throw new Error("Route is not defined: "+r)}p=this.base+"/"+s.route;n=e.isFunction(s.errorHandler)?s.errorHandler:null;u=e.isFunction(s.successHandler)?s.successHandler:null}}if(o in h.prototype){p=new h(p);t[r]=this[r]=function(t,e,s){return i(function(i,r){p[o](t,e,s).then(function(t){var e=this.successHandler||u;if(e){e(t.data,t)}i(this.rawResponse&&this.responseSimpleOnce===false?t:t.data);this.responseSimpleOnce=false}.bind(this),function(t){var e=this.errorHandler||n;if(e){e(t.data,t.status,t)}r(this.rawResponse&&this.responseSimpleOnce===false?t:t.status);this.responseSimpleOnce=false}.bind(this))}.bind(this))}}else{throw new Error("Http method is not defined: "+o)}}.bind(this))}return this}};function u(t,e){return new p(t,e)}return u}])})(window,window.angular);(function(t,e){"use strict";var i=e.$$minErr("$entity");e.module("ngEntity",["ng","ngResty"]).factory("$entity",["$resty","$q",function(t,i){var s=e.noop,r=e.forEach,n=e.extend,o=e.copy;var h={getAll:function(){return i.resolve()},getOne:function(){return i.resolve()},create:function(){return i.resolve()},"delete":function(){return i.resolve()},update:function(){return i.resolve()}};function p(t,i,s,n,o){if(e.isString(t)===false){throw new Error("Incorrect [alias].")}if(e.isString(s)===false&&e.isFunction(s)===false){throw new Error("Incorrect [mappedProperty].")}if(e.isObject(n)===false){n=h}this.alias=t;this.allMethod="getAll";this.delMethod="delete";this.defaults=void 0;this.k=null;this.mappedProperty=s;this.methods=o&&{};this.modelCache={};this.modelCacheIndex=1e7;this.modelMapper=null;this.oneMethod="getOne";this.putMethods=["create","update"];this.relations={};this.scope=i;this.transport=n;this.transportOptions={};this.wantWatcher=false;if(n.routes){r(n.routes,function(t,i){if(e.isFunction(s)){this[i]=function(){return t.call(n,this.mappedProperty(this.scope,this.k),this.mappedProperty(this.scope,this.k))}.bind(this)}else{this[i]=function(){return t.call(n,this.get(this.k),this.get(this.k))}.bind(this)}}.bind(this))}if(o){r(o,function(t,i){if(e.isString(t)){this.methods[i]=this[t]}else{this.methods[i]=t}}.bind(this))}}p.RELATION_ONE_TO_ONE=0;p.RELATION_ONE_TO_MANY=1;p.prototype={setAll:function(t){this.allMethod=t;return this},setDefaults:function(t){this.defaults=t;return this},setDel:function(t){this.delMethod=t;return this},setOne:function(t){this.oneMethod=t;return this},setPut:function(t,e){this.putMethods=[t,e];return this},setModelMapper:function(t){this.modelMapper=t;return this},setOneToOne:function(t,e,i,s){this.relations[t]=[e.setOneToOne(this.alias,p.RELATION_ONE_TO_ONE),p.RELATION_ONE_TO_ONE,i,s];return this},setOneToMany:function(t,e,i,s){this.relations[t]=[e.setOneToOne(this.alias,p.RELATION_ONE_TO_ONE),p.RELATION_ONE_TO_MANY,i,s];return this},setTransport:function(t){this.transport=t;return this},setTransportOptions:function(t){this.transportOptions=e.isObject(t)?t:{};return this},setWantWatcher:function(t){this.wantWatcher=t===true;return this},get:function(t,i){t=t!==void 0?t.toString().split("."):void 0;var s,r,n;if(e.isFunction(this.mappedProperty)){n=this.mappedProperty(this,t&&t[0])}else if(t===void 0){n=this.scope[this.mappedProperty]}else if(t[0]in this.scope[this.mappedProperty]){n=this.scope[this.mappedProperty]}else{throw new Error("Key is not defined: "+(t&&t[0]))}if(t===void 0){return n}for(s=0,r=t.length;s<r;s++){if(t[s]in n){n=n[t[s]]}else{return i}}return n},set:function(t,i){if(i===void 0){return e.isFunction(this.mappedProperty)?this.mappedProperty(this,void 0,t):this.scope[this.mappedProperty]=t}t=t.toString().split(".");var s,r,n;if(e.isFunction(this.mappedProperty)){n=this.mappedProperty(this,t&&t[0],i)}else if(t[0]in this.scope[this.mappedProperty]){n=this.scope[this.mappedProperty]}else{n=(e.isArray(this.scope[this.mappedProperty])?t[0]=this.scope[this.mappedProperty].push({})-1:this.scope[this.mappedProperty][t[0]]={})&&this.scope[this.mappedProperty]}for(s=0,r=t.length-1;s<r;s++){n=t[s]in n&&e.isObject(n[t[s]])?n[t[s]]:n[t[s]]={}}if(e.isArray(n)&&t[s]>=n.length){return n.push(i)}n[t[s]]=i;return t[s]},getRelated:function(t,e){if(t in this.relations){}throw new Error("Relation is not defined: "+t)},setRelated:function(t,e,i){if(t in this.relations){}throw new Error("Relation is not defined: "+t)},all:function(t){if(e.isFunction(this.transport[this.allMethod])===false){throw new Error("[getAll] transport method required.")}return i(function(i,s){this.transport.responseSimpleOnce=true;this.transport[this.allMethod](t).then(function(t){e.isFunction(this.mappedProperty)?this.mappedProperty(this.scope,t,true):this.scope[this.mappedProperty]=t;i(t)}.bind(this),s)}.bind(this))},append:function(t,i){var s=i===void 0?t:i;if(e.isArray(this.scope[this.mappedProperty])&&(i===void 0||t>=this.scope[this.mappedProperty].length)){this.scope[this.mappedProperty].push(s)}else{this.scope[this.mappedProperty][t]=s}return this},clear:function(){e.isString(this.mappedProperty)?this.scope[this.mappedProperty]={}:this.mappedProperty(this.scope,void 0,[]);this.modelCache={};return this},collection:function(){return this},del:function(t){if(e.isFunction(this.transport[this.delMethod])===false){throw new Error("[delete] transport method required.")}return i(function(i,s){this.transport[this.delMethod](this.get(t),this.get(t)).then(function(s){if(e.isArray(this.scope[this.mappedProperty])){this.scope[this.mappedProperty].splice(t,1)}else{delete this.scope[this.mappedProperty][t]}i(s)}.bind(this),s)}.bind(this))},on:function(t,e){var i=false;if(t in this.scope[this.mappedProperty]){this.k=t}else{e=e?n(e,this.defaults):this.defaults;if(e!==void 0){this.k=this.set(t,e);i=true}else{throw new Error("Key is not defined: "+t)}}if("$$isCached"in this.scope[this.mappedProperty][this.k]){return this.modelCache[this.scope[this.mappedProperty][this.k].$$isCached]}var s=this.modelCache[this.modelCacheIndex++]=c(this,this.k,i);this.get(this.k).$$isCached=this.modelCacheIndex-1;return s},one:function(t,s){if(e.isFunction(this.transport[this.oneMethod])===false){throw new Error("[getOne] transport method required.")}return i(function(i,r){this.transport.responseSimpleOnce=true;this.transport[this.oneMethod](t).then(function(t){var r=e.isFunction(this.mappedProperty)?this.mappedProperty(this.scope,s||true,t):this.set(s||t[this.modelMapper],t);i(t)}.bind(this),r)}.bind(this))},put:function(t,s){if(e.isFunction(this.transport[this.putMethods[0]])===false||e.isFunction(this.transport[this.putMethods[1]])===false){throw new Error("[create] or [update] transport method required.")}var n=[];r(t!==void 0?[this.get(t)]:this.get(),function(t){n.push(this.transport[this.putMethods[s===true?0:1]](t,t))}.bind(this));return i.all(n)},remove:function(t){delete this.modelCache[this.scope[this.mappedProperty][t].$$isCached];if(e.isArray(this.scope[this.mappedProperty])){this.scope[this.mappedProperty].splice(t,1)}else{delete this.scope[this.mappedProperty][t]}return this}};function u(t,e,s){this.$$isDirty=this.$$isNew=s===true;this.get=function(i,s){return t.get(e+"."+i,s)};this.set=function(i,s){this.$$isDirty=true;return t.set(e+"."+i,s)?this:this};this.collection=function(){return t};this.dirty=function(t){this.$$isDirty=t!==false;return this};this.del=function(){return i(function(i,s){t.del(e).then(function(e){t=null;i(e)},s)})};this.put=function(){return i(function(i,s){this.$$isDirty?t.put(e,this.$$isNew).then(function(t){this.$$isDirty=this.$$isNew=false;i(t)}.bind(this),s):i()}.bind(this))};if(t.methods){for(var r in t.methods){this[r]=t.methods[r]}}}u.setPrototype=function(t){u.prototype=t;return u};function a(t,e,i,s,r){return new p(t,e,i,s,r)}function c(t,e,i){return new(u.setPrototype(t.get(e)))(t,e,i)}return a}])})(window,window.angular);if(typeof module!=="undefined"&&typeof exports!=="undefined"&&module.exports===exports){module.exports="angular-entity"}