(function(t,e){"use strict";var i=e.$$minErr("$resty");e.module("Resty",["ng"]).factory("$resty",["$http","$q",function(t,i){var s=e.noop,n=e.forEach,r=e.extend,o=e.copy;function h(t,e,i,s){this.appendParams=i===true;this.compileStrictly=e!==false;this.defaults=s;this.route=t;var n,r=/[^\\]:([\w\$]+)/g,o=[];while(n=r.exec(t)){o.push(n[1])}this.routeParams=o;t=t.replace(/([^\\]):([\w\$]+)/g,"$1!@$#$2#$@!").replace("\\:",":");var h=t.indexOf("?");if(h!==-1){this.path=t.substr(0,h);this.q=t.substr(h+1)}else{this.path=t;this.q=null}}h.prototype={compileQuery:function(t){var i=this.appendParams,s=this.compileStrictly,r=this.path,h=this.route,u=this.q,p={};if(e.isObject(t)){if(this.defaults){t=o(t);for(var l in this.defaults){l in t||(t[l]=this.defaults[l])}}}else{t=this.defaults}if(e.isObject(t)){if(r){n(this.routeParams,function(e){if(e in t&&t[e]!==void 0){r=r.replace("!@$#"+e+"#$@!",t[e]!==null?t[e].toString():"");p[e]=true}else{if(s){throw new Error("Path parameter missing: "+e+" on "+h)}}})}if(u){n(this.routeParams,function(e){if(e in t&&t[e]!==void 0){u=u.replace("!@$#"+e+"#$@!",t[e]!==null?encodeURIComponent(t[e].toString()):"");p[e]=true}else{if(s){throw new Error("Path parameter missing: "+e+" on "+h)}}})}if(i){n(t,function(t,e){if(!(e in p)&&t!==void 0){u||(u="");u=u+"&"+e+"="+(t!==null?encodeURIComponent(t.toString()):"")}})}}return u?r+"?"+u:r},"delete":function(e,i,s){return t.delete(this.compileQuery(e),r(s||{},{data:i}))},get:function(e,i,s){return t.get(this.compileQuery(e),r(s||{},{data:i}))},head:function(e,i,s){return t.head(this.compileQuery(e),r(s||{},{data:i}))},options:function(e,i,s){return t.options(this.compileQuery(e),i,s)},patch:function(e,i,s){return t.patch(this.compileQuery(e),i,s)},post:function(e,i,s){return t.post(this.compileQuery(e),i,s)},put:function(e,i,s){return t.put(this.compileQuery(e),i,s)},trace:function(e,i,s){return t.trace(this.compileQuery(e),i,s)}};function u(t,e){this.base=t;this.compiledRoutes={};this.defaults=null;this.deferred=[];this.errorHandler=null;this.queued=false;this.rawResponse=true;this.responseSimpleOnce=false;this.routes=e;this.successHandler=null;this.onAfterRequest=null;this.onBeforeRequest=null;this.onRequest=null;this.addRoutes(e)}u.prototype={setDefaults:function(t){this.defaults=e.isObject(t)?t:null;return this},setErrorHandler:function(t){this.errorHandler=e.isFunction(t)?t:null;return this},setQueued:function(t){this.queued=t===true;return this},setRawResponse:function(t){this.rawResponse=t===true;return this},setResponseSimpleOnce:function(t){this.responseSimpleOnce=t===true;return this},setSuccessHandler:function(t){this.successHandler=e.isFunction(t)?t:null;return this},setOnAfterRequest:function(t){if(e.isFunction(t)){this.onAfterRequest=t;return this}throw new Error("Invalid [onAfterRequest] handler.")},setOnBeforeRequest:function(t){if(e.isFunction(t)){this.onBeforeRequest=t;return this}throw new Error("Invalid [onBeforeRequest] handler.")},setOnRequest:function(t){if(e.isFunction(t)){this.onRequest=t;return this}throw new Error("Invalid [onRequest] handler.")},addRoutes:function(t){if(e.isObject(t)){n(t,function(s,n){var r=false,o=true,u={},p,l,f,c;if(typeof s==="string"){l="get";f=this.base+"/"+s}else{if(e.isArray(s)){if(s.length===0){throw new Error("Route is not defined: "+n)}r=s[2]===true;u=e.isObject(s[3])?s[3]:this.defaults;l=s[1]||"get";f=this.base+"/"+s[0]}else{r=s.appendParams===true;o=s.compileStrictly!==false;u=e.isObject(s.defaults)?s.defaults:this.defaults;l=s.method||"get";if(s.route===void 0){throw new Error("Route is not defined: "+n)}f=this.base+"/"+s.route;p=e.isFunction(s.errorHandler)?s.errorHandler:null;c=e.isFunction(s.successHandler)?s.successHandler:null}}if(l in h.prototype){this.compiledRoutes[n]=f=new h(f,o,r,u);t[n]=this[n]=function(t,e,s){var n=i(function(i,n){var r=this.rawResponse;var o=this.responseSimpleOnce;if(this.onBeforeRequest){s=this.onBeforeRequest(s)}return f[l](t,e,s).then(function(t){var e=this.successHandler||c;if(e){e(t.data,t)}i(r&&o===false?t:t.data);this.responseSimpleOnce=false}.bind(this),function(t){var e=this.errorHandler||p;if(e){e(t.data,t.status,t)}n(r&&o===false?t:t.status);this.responseSimpleOnce=false}.bind(this))}.bind(this));if(this.onRequest){n=this.onRequest(n)}return n}}else{throw new Error("Http method is not defined: "+l)}}.bind(this))}return this},compile:function(t,e){if(t in this.compiledRoutes){return this.compiledRoutes[t].compileQuery(e)}throw new Error("Route is not defined: "+t)}};function p(t,e){return new u(t,e)}return p}])})(window,window.angular);(function(t,e){"use strict";var i=e.$$minErr("$entity");e.module("Entity",["ng","Resty"]).factory("$entity",["$resty","$q",function(t,i){var s=e.noop,n=e.forEach,r=e.extend,o=e.copy;function h(t,e){Object.defineProperty(t,e,{get:void 0,set:void 0});return h}var u={getAll:function(){return i.resolve()},getOne:function(){return i.resolve()},create:function(){return i.resolve()},"delete":function(){return i.resolve()},update:function(){return i.resolve()}};function p(t,i,s,r,o){if(e.isString(t)===false){throw new Error("Incorrect [alias].")}if(e.isString(s)===false&&e.isFunction(s)===false){throw new Error("Incorrect [mappedProperty].")}if(e.isObject(r)===false){r=u}this.alias=t;this.allMethod="getAll";this.delMethod="delete";this.defaults=void 0;this.digestScope=i.$applyAsync?i:null;this.k=null;this.mappedProperty=s;this.modelCache={};this.modelCacheIndex=1e7;this.modelDefinition=o||{};this.modelFactory=d;this.modelMapper=null;this.oneMethod="getOne";this.putMethods=["create","update"];this.relations={};this.scope=i;this.transport=r;this.transportOptions={};if(e.isString(s)){s=s.split(".");n(s.slice(0,s.length-1),function(t){i=i[t]});this.mappedProperty=s[s.length-1];this.scope=i}if(r.routes){n(r.routes,function(t,e){this[e]=t}.bind(this))}}p.RELATION_ONE_TO_ONE=0;p.RELATION_ONE_TO_MANY=1;p.prototype={get:function(t,i){t=t!==void 0?t.toString().split("."):void 0;var s,n,r;if(e.isFunction(this.mappedProperty)){r=this.mappedProperty(this,t&&t[0])}else if(t===void 0){r=this.scope[this.mappedProperty]}else if(t[0]in this.scope[this.mappedProperty]){r=this.scope[this.mappedProperty]}else{throw new Error("Key is not defined: "+(t&&t[0]))}if(t===void 0){return r}for(s=0,n=t.length;s<n;s++){if(t[s]in r){r=r[t[s]]}else{return i}}return r},set:function(t,i){t=t.toString().split(".");var s,n,r;if(e.isFunction(this.mappedProperty)){r=this.mappedProperty(this,t&&t[0],i)}else if(t[0]in this.scope[this.mappedProperty]){r=this.scope[this.mappedProperty]}else{if(e.isArray(this.scope[this.mappedProperty])){t[0]=this.scope[this.mappedProperty].push({})-1}else{this.scope[this.mappedProperty][t[0]]={}}r=this.scope[this.mappedProperty]}for(s=0,n=t.length-1;s<n;s++){r=t[s]in r&&e.isObject(r[t[s]])?r[t[s]]:r[t[s]]={}}if(e.isArray(r)){if(t[s]>=r.length){r.push(i);this.apply();return i}else if(t[s]<0){r.unshift(i);this.apply();return i}}r[t[s]]=i;this.apply();return t[s]},getRelated:function(t,e){if(!(t in this.relations)){throw new Error("Relation is not defined: "+t)}},getRoot:function(t){if(!(t in this.scope[this.mappedProperty])){throw new Error("Key is not defined: "+t)}return this.scope[this.mappedProperty][t]},setAll:function(t){this.allMethod=t;return this},setDefaults:function(t){this.defaults=t;return this},setDel:function(t){this.delMethod=t;return this},setDigestScope:function(t){if(!t.$applyAsync){throw new Error("Is not [$scope].")}this.digestScope=t;return this},setEntire:function(t){this.scope[this.mappedProperty]=t;return this},setModelMapper:function(t){this.modelMapper=t;return this},setOne:function(t){this.oneMethod=t;return this},setOneToOne:function(t,e,i,s){this.relations[t]=[e.setOneToOne(this.alias,p.RELATION_ONE_TO_ONE),p.RELATION_ONE_TO_ONE,i,s];return this},setOneToMany:function(t,e,i,s){this.relations[t]=[e.setOneToOne(this.alias,p.RELATION_ONE_TO_ONE),p.RELATION_ONE_TO_MANY,i,s];return this},setPut:function(t,e){this.putMethods=[t,e];return this},setRelated:function(t,e,i){if(!(t in this.relations)){throw new Error("Relation is not defined: "+t)}return this},setTransport:function(t){this.transport=t;return this},setTransportOptions:function(t){this.transportOptions=e.isObject(t)?t:{};return this},all:function(t){if(e.isFunction(this.transport[this.allMethod])===false){throw new Error("[getAll] transport method required.")}return i(function(i,s){this.transport.responseSimpleOnce=true;this.transport[this.allMethod](t).then(function(t){e.isFunction(this.mappedProperty)?this.mappedProperty(this.scope,t,true):this.scope[this.mappedProperty]=t;i(t)}.bind(this),s)}.bind(this))},append:function(t,i){if(e.isArray(this.scope[this.mappedProperty])&&(i===void 0||t>=this.scope[this.mappedProperty].length)){this.scope[this.mappedProperty].push(i===void 0?t:i)}else{this.scope[this.mappedProperty][t]=i===void 0?t:i}return this},apply:function(){var t;if(this.digestScope){t=this.digestScope}else{t=this.scope}if(t.$applyAsync){t.$applyAsync()}return this},clear:function(){this.flush();e.isString(this.mappedProperty)?this.scope[this.mappedProperty]={}:this.mappedProperty(this.scope,void 0,[]);return this},collection:function(){return this},del:function(t){if(e.isFunction(this.transport[this.delMethod])===false){throw new Error("[delete] transport method required.")}return i(function(i,s){this.transport[this.delMethod](this.get(t),this.get(t)).then(function(s){if(e.isArray(this.scope[this.mappedProperty])){this.scope[this.mappedProperty].splice(t,1)}else{delete this.scope[this.mappedProperty][t]}i(s)}.bind(this),s)}.bind(this))},flush:function(){n(this.modelCache,function(t){t.$$free()});this.modelCache={};return this},on:function(t,e){var i=false;if(t in this.scope[this.mappedProperty]){this.k=t}else{e=e?r(e,this.defaults):this.defaults;if(e!==void 0){this.k=this.set(t,e);i=true}else{throw new Error("Key is not defined: "+t)}}if("$$isCached"in this.scope[this.mappedProperty][this.k]){return this.modelCache[this.scope[this.mappedProperty][this.k].$$isCached]}var s=this.modelCache[this.modelCacheIndex++]=this.modelFactory(this,this.k,i);this.get(this.k).$$isCached=this.modelCacheIndex-1;return s},one:function(t,s){if(e.isFunction(this.transport[this.oneMethod])===false){throw new Error("[getOne] transport method required.")}return i(function(i,n){this.transport.responseSimpleOnce=true;this.transport[this.oneMethod](t).then(function(t){var n=e.isFunction(this.mappedProperty)?this.mappedProperty(this.scope,s||true,t):this.set(s||t[this.modelMapper],t);i(t)}.bind(this),n)}.bind(this))},put:function(t,s){if(e.isFunction(this.transport[this.putMethods[0]])===false||e.isFunction(this.transport[this.putMethods[1]])===false){throw new Error("[create] or [update] transport method required.")}var r=[];n(t!==void 0?[this.get(t)]:this.get(),function(t){r.push(this.transport[this.putMethods[s===true?0:1]](t,t))}.bind(this));return i.all(r)},remove:function(t){delete this.modelCache[this.scope[this.mappedProperty][t].$$isCached];if(e.isArray(this.scope[this.mappedProperty])){this.scope[this.mappedProperty].splice(t,1)}else{delete this.scope[this.mappedProperty][t]}return this},simplified:function(){this.modelFactory=m;return this},unsafe:function(){this.modelFactory=y;return this}};function l(t,s,n){this.$$isDirty=this.$$isNew=n===true;this.get=function(e,i){return t.get(s+"."+e,i)};this.set=function(e,i){return(this.$$isDirty=true)&&t.set(s+"."+e,i)?this:this};Object.defineProperty(this,"$$col",{get:function(){return t},configurable:true});this.$$free=function(){t&&h(this,"$$col");t=null};this.del=function(){return i(function(e,i){t.del(s).then(function(t){this.$$free();e(t)}.bind(this),i)}.bind(this))};this.put=function(){return i(function(e,i){this.$$isDirty?t.put(s,this.$$isNew).then(function(t){this.$$isDirty=this.$$isNew=false;e(t)}.bind(this),i):e()}.bind(this))};if(t.modelDefinition){var r=t.getRoot(s);if(e.isFunction(t.modelDefinition)){t.modelDefinition.call(this,r)}else{for(var o in t.modelDefinition){if(e.isFunction(t.modelDefinition[o])){this[o]=t.modelDefinition[o]}else{r[o]=t.modelDefinition[o]}}}}}l.setPrototype=function(t){l.prototype=t;return l};function f(t,s,n){this.$$isDirty=this.$$isNew=n===true;Object.defineProperty(this,"_",{get:function(){return t.getRoot(s)},configurable:true});Object.defineProperty(this,"$$col",{get:function(){return t},configurable:true});this.$$free=function(){t&&h(this,"_")(this,"$$col");t=null};this.$$apply=function(){var t=this._;for(o in this){if(this.hasOwnProperty(o)&&e.isFunction(this[o])===false){t[o]=this[o];delete this[o]}}this.$$col.apply()};this.del=function(){return i(function(e,i){t.del(s).then(function(t){this.$$free();e(t)}.bind(this),i)}.bind(this))};this.put=function(){return i(function(e,i){this.$$isDirty?t.put(s,this.$$isNew).then(function(t){this.$$isDirty=this.$$isNew=false;e(t)}.bind(this),i):e()}.bind(this))};if(t.modelDefinition){var r=t.getRoot(s);if(e.isFunction(t.modelDefinition)){t.modelDefinition.call(this,r)}else{for(var o in t.modelDefinition){if(e.isFunction(t.modelDefinition[o])){this[o]=t.modelDefinition[o]}else{r[o]=t.modelDefinition[o]}}}}}f.setPrototype=function(t){f.prototype=t;return f};function c(t,s,n){this.$$isDirty=this.$$isNew=n===true;Object.defineProperty(this,"_",{get:function(){return t.getRoot(s)},configurable:true});Object.defineProperty(this,"$",{get:function(){return t.apply()&&t.getRoot(s)},configurable:true});Object.defineProperty(this,"$$col",{get:function(){return t},configurable:true});this.$$free=function(){t&&h(this,"_")(this,"$")(this,"$$col");t=null};this.del=function(){return i(function(e,i){t.del(s).then(function(t){this.$$free();e(t)}.bind(this),i)}.bind(this))};this.put=function(){return i(function(e,i){this.$$isDirty?t.put(s,this.$$isNew).then(function(t){this.$$isDirty=this.$$isNew=false;e(t)}.bind(this),i):e()}.bind(this))};if(t.modelDefinition){var r=t.getRoot(s);if(e.isFunction(t.modelDefinition)){t.modelDefinition.call(this,r)}else{for(var o in t.modelDefinition){if(e.isFunction(t.modelDefinition[o])){this[o]=t.modelDefinition[o]}else{r[o]=t.modelDefinition[o]}}}}}c.setPrototype=function(t){c.prototype=t;return c};function a(t,e,i,s,n){return new p(t,e,i,s,n)}function d(t,e,i){return new(l.setPrototype(t.get(e)))(t,e,i)}function m(t,e,i){return new(f.setPrototype(t.get(e)))(t,e,i)}function y(t,e,i){return new(c.setPrototype(t.get(e)))(t,e,i)}return a}])})(window,window.angular);if(typeof module!=="undefined"&&typeof exports!=="undefined"&&module.exports===exports){module.exports="angular-entity"}